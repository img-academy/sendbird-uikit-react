{"version":3,"file":"MessageInput.js","sources":["../../../src/smart-components/Channel/components/MessageInput/index.tsx"],"sourcesContent":["import React, { useState, useContext, useEffect } from 'react';\n\nimport './message-input.scss';\nimport * as utils from '../../context/utils';\n\nimport MessageInput from '../../../../ui/MessageInput';\nimport QuoteMessageInput from '../../../../ui/QuoteMessageInput';\nimport { LocalizationContext } from '../../../../lib/LocalizationContext';\nimport { useChannel } from '../../context/ChannelProvider';\nimport useSendbirdStateContext from '../../../../hooks/useSendbirdStateContext';\nimport SuggestedMentionList from '../SuggestedMentionList';\nimport { MessageInputKeys } from '../../../../ui/MessageInput/const';\n\nconst MessageInputWrapper = (): JSX.Element => {\n  const {\n    currentGroupChannel,\n    initialized,\n    quoteMessage,\n    sendMessage,\n    sendFileMessage,\n    setQuoteMessage,\n    messageInputRef,\n    renderUserMentionItem,\n  } = useChannel();\n  const globalStore = useSendbirdStateContext();\n  const channel = currentGroupChannel;\n\n  const { isOnline, isMentionEnabled, userMention } = globalStore?.config;\n  const maxUserMentionCount = userMention?.maxMentionCount || 10;\n  const maxUserSuggestionCount = userMention?.maxSuggestionCount || 15;\n\n  const { stringSet } = useContext(LocalizationContext);\n  const [mentionNickname, setMentionNickname] = useState('');\n  const [mentionedUsers, setMentionedUsers] = useState([]);\n  const [mentionedUserIds, setMentionedUserIds] = useState([]);\n  const [selectedUser, setSelectedUser] = useState(null);\n  const [mentionSuggestedUsers, setMentionSuggestedUsers] = useState([]);\n  const [ableMention, setAbleMention] = useState(true);\n  const [messageInputEvent, setMessageInputEvent] = useState(null);\n  const disabled = !initialized\n    || utils.isDisabledBecauseFrozen(channel)\n    || utils.isDisabledBecauseMuted(channel)\n    || !isOnline;\n  const isOperator = utils.isOperator(channel);\n  const { isBroadcast } = channel;\n\n  const displaySuggestedMentionList = isOnline\n    && isMentionEnabled\n    && mentionNickname.length > 0\n    && !utils.isDisabledBecauseFrozen(channel)\n    && !utils.isDisabledBecauseMuted(channel);\n\n  // Reset when channel changes\n  useEffect(() => {\n    setMentionNickname('');\n    setMentionedUsers([]);\n    setMentionedUserIds([]);\n    setSelectedUser(null);\n    setMentionSuggestedUsers([]);\n    setAbleMention(true);\n    setMessageInputEvent(null);\n  }, [channel?.url]);\n\n  useEffect(() => {\n    if (mentionedUsers?.length >= maxUserMentionCount) {\n      setAbleMention(false);\n    } else {\n      setAbleMention(true);\n    }\n  }, [mentionedUsers]);\n\n  useEffect(() => {\n    setMentionedUsers(mentionedUsers.filter(({ userId }) => {\n      const i = mentionedUserIds.indexOf(userId);\n      if (i < 0) {\n        return false;\n      } else {\n        mentionedUserIds.splice(i, 1);\n        return true;\n      }\n    }));\n  }, [mentionedUserIds]);\n\n  // broadcast channel + not operator\n  if (isBroadcast && !isOperator) {\n    return null;\n  }\n  // other conditions\n  return (\n    <div className=\"sendbird-message-input-wrapper\">\n      {\n        displaySuggestedMentionList && (\n          <SuggestedMentionList\n            targetNickname={mentionNickname}\n            inputEvent={messageInputEvent}\n            renderUserMentionItem={renderUserMentionItem}\n            onUserItemClick={(user) => {\n              if (user) {\n                setMentionedUsers([...mentionedUsers, user]);\n              }\n              setMentionNickname('');\n              setSelectedUser(user);\n              setMessageInputEvent(null);\n            }}\n            onFocusItemChange={() => {\n              setMessageInputEvent(null);\n            }}\n            onFetchUsers={(users) => {\n              setMentionSuggestedUsers(users);\n            }}\n            ableAddMention={ableMention}\n            maxMentionCount={maxUserMentionCount}\n            maxSuggestionCount={maxUserSuggestionCount}\n          />\n        )\n      }\n      {quoteMessage && (\n        <div className=\"sendbird-message-input-wrapper__quote-message-input\">\n          <QuoteMessageInput\n            replyingMessage={quoteMessage}\n            onClose={() => setQuoteMessage(null)}\n          />\n        </div>\n      )}\n      <MessageInput\n        className=\"sendbird-message-input-wrapper__message-input\"\n        channelUrl={channel?.url}\n        mentionSelectedUser={selectedUser}\n        isMentionEnabled={isMentionEnabled}\n        placeholder={\n          (quoteMessage && stringSet.MESSAGE_INPUT__QUOTE_REPLY__PLACE_HOLDER)\n          || (utils.isDisabledBecauseFrozen(channel) && stringSet.MESSAGE_INPUT__PLACE_HOLDER__DISABLED)\n          || (utils.isDisabledBecauseMuted(channel) && stringSet.MESSAGE_INPUT__PLACE_HOLDER__MUTED)\n        }\n        ref={messageInputRef}\n        disabled={disabled}\n        onStartTyping={() => {\n          channel?.startTyping();\n        }}\n        onInputEmpty={() => {\n          channel?.endTyping();\n        }}\n        onSendMessage={({ message, mentionTemplate }) => {\n          sendMessage({\n            message,\n            quoteMessage,\n            mentionedUsers,\n            mentionTemplate,\n          });\n          setMentionNickname('');\n          setMentionedUsers([]);\n          setQuoteMessage(null);\n          channel?.endTyping();\n        }}\n        onFileUpload={(file) => {\n          sendFileMessage(file, quoteMessage);\n          setQuoteMessage(null);\n        }}\n        onUserMentioned={(user) => {\n          if (selectedUser?.userId === user?.userId) {\n            setSelectedUser(null);\n            setMentionNickname('');\n          }\n        }}\n        onMentionStringChange={(mentionText) => {\n          setMentionNickname(mentionText);\n        }}\n        onMentionedUserIdsUpdated={(userIds) => {\n          setMentionedUserIds(userIds);\n        }}\n        onKeyDown={(e) => {\n          if (displaySuggestedMentionList && mentionSuggestedUsers?.length > 0\n            && ((e.key === MessageInputKeys.Enter && ableMention) || e.key === MessageInputKeys.ArrowUp || e.key === MessageInputKeys.ArrowDown)\n          ) {\n            setMessageInputEvent(e);\n            return true;\n          }\n          return false;\n        }}\n      />\n    </div>\n  );\n}\n\nexport default React.forwardRef(MessageInputWrapper);\n"],"names":["MessageInputWrapper","_a","useChannel","currentGroupChannel","initialized","quoteMessage","sendMessage","sendFileMessage","setQuoteMessage","messageInputRef","renderUserMentionItem","globalStore","useSendbirdStateContext","channel","_b","config","isOnline","isMentionEnabled","userMention","maxUserMentionCount","maxMentionCount","maxUserSuggestionCount","maxSuggestionCount","stringSet","useContext","LocalizationContext","_c","useState","mentionNickname","setMentionNickname","_d","mentionedUsers","setMentionedUsers","_e","mentionedUserIds","setMentionedUserIds","_f","selectedUser","setSelectedUser","_g","mentionSuggestedUsers","setMentionSuggestedUsers","_h","ableMention","setAbleMention","_j","messageInputEvent","setMessageInputEvent","disabled","utils","isOperator","isBroadcast","displaySuggestedMentionList","length","useEffect","url","filter","userId","i","indexOf","splice","React","user","users","MESSAGE_INPUT__QUOTE_REPLY__PLACE_HOLDER","MESSAGE_INPUT__PLACE_HOLDER__DISABLED","MESSAGE_INPUT__PLACE_HOLDER__MUTED","startTyping","endTyping","message","mentionTemplate","file","mentionText","userIds","e","key","MessageInputKeys","Enter","ArrowUp","ArrowDown","forwardRef"],"mappings":"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"}