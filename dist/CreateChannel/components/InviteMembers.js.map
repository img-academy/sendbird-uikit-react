{"version":3,"file":"InviteMembers.js","sources":["../../../src/smart-components/CreateChannel/components/InviteMembers/utils.ts","../../../src/smart-components/CreateChannel/components/InviteMembers/index.tsx"],"sourcesContent":["import SendBird from \"sendbird\";\nimport { CHANNEL_TYPE } from \"../../types\";\n\nexport const filterUser = (idsToFilter: string[]) => (currentId: string): boolean => idsToFilter?.includes(currentId);\n\nexport const setChannelType = (\n  params: SendBird.GroupChannelParams,\n  type: CHANNEL_TYPE,\n): SendBird.GroupChannelParams => {\n  if (type === 'broadcast') {\n    // eslint-disable-next-line no-param-reassign\n    params.isBroadcast = true;\n  }\n  if (type === 'supergroup') {\n    // eslint-disable-next-line no-param-reassign\n    params.isSuper = true;\n  }\n  return params;\n};\n\ntype CreateDefaultUserListQueryType = {\n  sdk: SendBird.SendBirdInstance;\n  userFilledApplicationUserListQuery?: SendBird.ApplicationUserListQuery;\n}\n\nexport const createDefaultUserListQuery = (\n  { sdk, userFilledApplicationUserListQuery }: CreateDefaultUserListQueryType\n): SendBird.ApplicationUserListQuery => {\n  const params = sdk.createApplicationUserListQuery();\n  if (userFilledApplicationUserListQuery) {\n    Object.keys(userFilledApplicationUserListQuery).forEach((key) => {\n      params[key] = userFilledApplicationUserListQuery[key];\n    });\n  }\n  return params;\n};\n","import React, { useState, useEffect, useContext } from 'react';\n\nimport './invite-members.scss';\nimport { LocalizationContext } from '../../../../lib/LocalizationContext';\nimport { useCreateChannelContext } from '../../context/CreateChannelProvider';\nimport useSendbirdStateContext from '../../../../hooks/useSendbirdStateContext';\n\nimport Modal from '../../../../ui/Modal';\nimport Label, {\n  LabelColors,\n  LabelTypography,\n} from '../../../../ui/Label';\nimport { ButtonTypes } from '../../../../ui/Button';\nimport UserListItem from '../../../../ui/UserListItem';\n\nimport {\n  filterUser,\n  setChannelType,\n  createDefaultUserListQuery,\n} from './utils';\nimport SendBird from 'sendbird';\n\nexport interface InviteMembersProps {\n  onCancel?: () => void;\n}\n\nconst InviteMembers: React.FC<InviteMembersProps> = ({ onCancel }: InviteMembersProps) => {\n  const {\n    onBeforeCreateChannel,\n    onCreateChannel,\n    createChannel,\n    type,\n  } = useCreateChannelContext();\n\n  const globalStore = useSendbirdStateContext();\n  const userId = globalStore?.config?.userId;\n  const sdk = globalStore?.stores?.sdkStore?.sdk;\n  const idsToFilter = [userId];\n  const [users, setUsers] = useState([]);\n  const [selectedUsers, setSelectedUsers] = useState({});\n  const { stringSet } = useContext(LocalizationContext);\n  const [usersDataSource, setUsersDataSource] = useState<SendBird.ApplicationUserListQuery>(null);\n  const selectedCount = Object.keys(selectedUsers).length;\n  const titleText = stringSet.MODAL__CREATE_CHANNEL__TITLE;\n  const submitText = stringSet.BUTTON__CREATE;\n\n  const userQueryCreator = createDefaultUserListQuery({ sdk });\n\n  useEffect(() => {\n    const applicationUserListQuery = userQueryCreator;\n    setUsersDataSource(applicationUserListQuery);\n    applicationUserListQuery.next((users_) => {\n      setUsers(users_);\n    });\n  }, []);\n\n  return (\n    <Modal\n      titleText={titleText}\n      submitText={submitText}\n      type={ButtonTypes.PRIMARY}\n      onCancel={onCancel}\n      onSubmit={() => {\n        const selectedUserList = Object.keys(selectedUsers);\n        if (selectedUserList.length > 0) {\n          if (onBeforeCreateChannel) {\n            const params = onBeforeCreateChannel(selectedUserList);\n            setChannelType(params, type);\n            createChannel(params).then((channel) => {\n              onCreateChannel(channel);\n            });\n          } else {\n            const params = new sdk.GroupChannelParams();\n            params.addUserIds(selectedUserList);\n            params.isDistinct = false;\n            if (userId) {\n              params.operatorUserIds = [userId];\n            }\n            setChannelType(params, type);\n            // do not have custom params\n            createChannel(params).then((channel) => {\n              onCreateChannel(channel);\n            });\n          }\n          onCancel();\n        }\n      }}\n    >\n      <div>\n        <Label\n          color={(selectedCount > 0) ? LabelColors.PRIMARY : LabelColors.ONBACKGROUND_3}\n          type={LabelTypography.CAPTION_1}\n        >\n          {`${selectedCount} ${stringSet.MODAL__INVITE_MEMBER__SELECTEC}`}\n        </Label>\n        <div\n          className=\"sendbird-create-channel--scroll\"\n          onScroll={(e) => {\n            const eventTarget = e.target as HTMLDivElement;\n            const { hasNext } = usersDataSource;\n            const fetchMore = (\n              eventTarget.clientHeight + eventTarget.scrollTop === eventTarget.scrollHeight\n            );\n\n            if (hasNext && fetchMore) {\n              usersDataSource.next((usersBatch, error) => {\n                if (error) {\n                  return;\n                }\n                setUsers([\n                  ...users,\n                  ...usersBatch,\n                ]);\n              });\n            }\n          }}\n        >\n          {\n            users.map((user) => (!filterUser(idsToFilter)(user.userId)) && (\n              <UserListItem\n                key={user.userId}\n                user={user}\n                checkBox\n                checked={selectedUsers[user.userId]}\n                onChange={\n                  (event) => {\n                    const modifiedSelectedUsers = {\n                      ...selectedUsers,\n                      [event.target.id]: event.target.checked,\n                    };\n                    if (!event.target.checked) {\n                      delete modifiedSelectedUsers[event.target.id];\n                    }\n                    setSelectedUsers(modifiedSelectedUsers);\n                  }\n                }\n              />\n            ))\n          }\n        </div>\n      </div>\n    </Modal>\n  );\n};\n\nexport default InviteMembers;\n"],"names":["filterUser","idsToFilter","currentId","includes","setChannelType","params","type","isBroadcast","isSuper","createDefaultUserListQuery","_a","sdk","userFilledApplicationUserListQuery","createApplicationUserListQuery","Object","keys","forEach","key","InviteMembers","onCancel","_e","useCreateChannelContext","onBeforeCreateChannel","onCreateChannel","createChannel","globalStore","useSendbirdStateContext","userId","config","stores","sdkStore","_f","useState","users","setUsers","_g","selectedUsers","setSelectedUsers","stringSet","useContext","LocalizationContext","_h","usersDataSource","setUsersDataSource","selectedCount","length","titleText","MODAL__CREATE_CHANNEL__TITLE","submitText","BUTTON__CREATE","userQueryCreator","useEffect","applicationUserListQuery","next","users_","React","ButtonTypes","PRIMARY","selectedUserList","then","channel","GroupChannelParams","addUserIds","isDistinct","operatorUserIds","LabelColors","ONBACKGROUND_3","LabelTypography","CAPTION_1","MODAL__INVITE_MEMBER__SELECTEC","e","eventTarget","target","hasNext","fetchMore","clientHeight","scrollTop","scrollHeight","usersBatch","error","map","user","event","modifiedSelectedUsers","id","checked"],"mappings":"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"}