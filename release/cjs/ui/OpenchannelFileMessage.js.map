{"version":3,"file":"OpenchannelFileMessage.js","sources":["../../../src/ui/OpenchannelFileMessage/utils.ts","../../../src/ui/OpenchannelFileMessage/index.tsx"],"sourcesContent":["import { IconTypes } from '../Icon';\n\nexport const checkFileType = (fileUrl: string): string => {\n  const audioFile = /(\\.mp3)$/i;\n  const gifFile = /(\\.gif)$/i;\n  if (audioFile.test(fileUrl)) {\n    return IconTypes.FILE_AUDIO;\n  }\n  if (gifFile.test(fileUrl)) {\n    return IconTypes.GIF\n  }\n  return IconTypes.FILE_DOCUMENT;\n}\n\nexport const truncate = (fullStr:string, strLen: number): string => {\n  if (fullStr === null || fullStr === undefined) return '';\n  if (fullStr.length <= strLen) return fullStr;\n  const separator = '...';\n  const sepLen = separator.length;\n  const charsToShow = strLen - sepLen;\n  const frontChars = Math.ceil(charsToShow / 2);\n  const backChars = Math.floor(charsToShow / 2);\n  return fullStr.substr(0, frontChars) + separator + fullStr.substr(fullStr.length - backChars);\n};\n","import React, { useContext, useRef } from 'react';\nimport format from 'date-fns/format';\nimport './index.scss';\n\nimport Avatar from '../Avatar';\nimport ContextMenu, { MenuItems, MenuItem } from '../ContextMenu';\nimport Label, { LabelTypography, LabelColors } from '../Label';\nimport Loader from '../Loader';\nimport Icon, { IconTypes, IconColors } from '../Icon';\nimport IconButton from '../IconButton';\nimport TextButton from '../TextButton';\nimport UserProfile from '../UserProfile';\nimport { UserProfileContext } from '../../lib/UserProfileContext';\n\nimport { useLocalization } from '../../lib/LocalizationContext';\nimport { checkFileType, truncate } from './utils';\nimport { ClientFileMessage } from '../../index';\nimport {\n  checkIsByMe,\n  checkIsPending,\n  checkIsFailed,\n  isFineDelete,\n  isFineResend,\n  showMenuTrigger,\n} from '../../utils/openChannelUtils';\nimport { getSenderFromMessage } from '../../utils/openChannelUtils';\n\ninterface Props {\n  className?: string | Array<string>;\n  message: ClientFileMessage;\n  userId: string;\n  disabled?: boolean;\n  chainTop?: boolean;\n  chainBottom?: boolean;\n  showRemove(bool: boolean): void;\n  resendMessage(message: ClientFileMessage): void;\n}\n\nexport default function OpenchannelFileMessage({\n  className,\n  message,\n  userId,\n  disabled,\n  chainTop,\n  showRemove,\n  resendMessage,\n}: Props): JSX.Element {\n  const status = message?.sendingStatus;\n  const { dateLocale, stringSet } = useLocalization();\n  const contextMenuRef = useRef(null);\n  const avatarRef = useRef(null);\n  const { disableUserProfile, renderUserProfile } = useContext(UserProfileContext);\n\n  const openFileUrl = () => { window.open(message.url); };\n\n  const isByMe = checkIsByMe(message, userId);\n  const isPending = checkIsPending(status);\n  const isFailed = checkIsFailed(status);\n  const sender = getSenderFromMessage(message);\n\n  return (\n    <div\n      className={[\n        ...(Array.isArray(className) ? className : [className]),\n        'sendbird-openchannel-file-message',\n      ].join(' ')}\n    >\n      <div className=\"sendbird-openchannel-file-message__left\">\n        {\n            !chainTop && (\n              <ContextMenu\n                menuTrigger={(toggleDropdown) => (\n                  <Avatar\n                    className=\"sendbird-openchannel-file-message__left__avatar\"\n                    src={sender.profileUrl || ''}\n                    ref={avatarRef}\n                    width=\"28px\"\n                    height=\"28px\"\n                    onClick={() => {\n                      if (!disableUserProfile) {\n                        toggleDropdown();\n                      }\n                    }}\n                  />\n                )}\n                menuItems={(closeDropdown) => (\n                  <MenuItems\n                    parentRef={avatarRef}\n                    parentContainRef={avatarRef}\n                    closeDropdown={closeDropdown}\n                    style={{ paddingTop: 0, paddingBottom: 0 }}\n                  >\n                    {\n                      renderUserProfile\n                      ? (\n                        renderUserProfile({\n                          user: sender,\n                          close: closeDropdown,\n                        })\n                      )\n                      : (\n                        <UserProfile\n                          user={sender}\n                          onSuccess={closeDropdown}\n                          disableMessaging\n                        />\n                      )\n                    }\n                  </MenuItems>\n                )}\n              />\n            )\n          }\n      </div>\n      <div className=\"sendbird-openchannel-file-message__right\">\n        {\n          !chainTop && (\n            <div className=\"sendbird-openchannel-file-message__right__title\">\n              <Label\n                className=\"sendbird-openchannel-file-message__right__title__sender-name\"\n                type={LabelTypography.CAPTION_2}\n                color={isByMe ? LabelColors.SECONDARY_3 : LabelColors.ONBACKGROUND_2}\n              >\n                {\n                  sender && (\n                    sender.friendName\n                    || sender.nickname\n                    || sender.userId\n                  )\n                }\n              </Label>\n              <Label\n                className=\"sendbird-openchannel-file-message__right__title__sent-at\"\n                type={LabelTypography.CAPTION_3}\n                color={LabelColors.ONBACKGROUND_3}\n              >\n                {\n                  message?.createdAt && (\n                    format(message.createdAt, 'p', {\n                      locale: dateLocale,\n                    })\n                  )\n                }\n              </Label>\n            </div>\n          )\n        }\n        <div className=\"sendbird-openchannel-file-message__right__body\">\n          {\n            checkFileType(message.url) && (\n              <Icon\n                className=\"sendbird-openchannel-file-message__right__body__icon\"\n                type={checkFileType(message.url)}\n                fillColor={IconColors.PRIMARY}\n                width=\"48px\"\n                height=\"48px\"\n              />\n            )\n          }\n          <TextButton\n            className=\"sendbird-openchannel-file-message__right__body__file-name\"\n            onClick={openFileUrl}\n          >\n            <Label\n              type={LabelTypography.BODY_1}\n              color={LabelColors.ONBACKGROUND_1}\n            >\n              {truncate(message.name || message.url, 40)}\n            </Label>\n          </TextButton>\n        </div>\n        {\n          (isPending || isFailed) && (\n            <div className=\"sendbird-openchannel-file-message__right__tail\">\n              {\n                isPending && (\n                  <Loader\n                    width=\"16px\"\n                    height=\"16px\"\n                  >\n                    <Icon\n                      className=\"sendbird-openchannel-file-message__right__tail__pending\"\n                      type={IconTypes.SPINNER}\n                      fillColor={IconColors.PRIMARY}\n                      width=\"16px\"\n                      height=\"16px\"\n                    />\n                  </Loader>\n                )\n              }\n              {\n                isFailed && (\n                  <Icon\n                    className=\"sendbird-openchannel-file-message__right__tail__failed\"\n                    type={IconTypes.ERROR}\n                    fillColor={IconColors.ERROR}\n                    width=\"16px\"\n                    height=\"16px\"\n                  />\n                )\n              }\n            </div>\n          )\n        }\n      </div>\n      <div\n        className=\"sendbird-openchannel-file-message__context-menu\"\n        ref={contextMenuRef}\n      >\n        {\n            <ContextMenu\n              menuTrigger={(toggleDropdown) => (\n                showMenuTrigger({ message, userId, status }) && (\n                  <IconButton\n                    className=\"sendbird-openchannel-file-message__context-menu__icon\"\n                    width=\"32px\"\n                    height=\"32px\"\n                    onClick={toggleDropdown}\n                  >\n                    <Icon\n                      type={IconTypes.MORE}\n                      width=\"24px\"\n                      height=\"24px\"\n                    />\n                  </IconButton>\n                )\n              )}\n              menuItems={(closeDropdown) => (\n                <MenuItems\n                  parentRef={contextMenuRef}\n                  parentContainRef={contextMenuRef}\n                  closeDropdown={closeDropdown}\n                  openLeft\n                >\n                  {\n                    isFineResend({ message, userId, status }) && (\n                      <MenuItem\n                        onClick={() => {\n                          if (disabled) { return; }\n                          resendMessage(message);\n                          closeDropdown();\n                        }}\n                      >\n                        {stringSet.CONTEXT_MENU_DROPDOWN__RESEND}\n                      </MenuItem>\n                    )\n                  }\n                  {\n                    isFineDelete({ message, userId, status }) && (\n                      <MenuItem\n                        onClick={() => {\n                          if (disabled) { return; }\n                          showRemove(true);\n                          closeDropdown();\n                        }}\n                      >\n                        {stringSet.CONTEXT_MENU_DROPDOWN__DELETE}\n                      </MenuItem>\n                    )\n                  }\n                </MenuItems>\n              )}\n            />\n        }\n      </div>\n    </div>\n  );\n}\n"],"names":["checkFileType","fileUrl","audioFile","gifFile","test","IconTypes","FILE_AUDIO","GIF","FILE_DOCUMENT","truncate","fullStr","strLen","undefined","length","separator","sepLen","charsToShow","frontChars","Math","ceil","backChars","floor","substr","OpenchannelFileMessage","_a","className","message","userId","disabled","chainTop","showRemove","resendMessage","status","sendingStatus","_b","useLocalization","dateLocale","stringSet","contextMenuRef","useRef","avatarRef","_c","useContext","UserProfileContext","disableUserProfile","renderUserProfile","openFileUrl","window","open","url","isByMe","checkIsByMe","isPending","checkIsPending","isFailed","checkIsFailed","sender","getSenderFromMessage","React","__spreadArray","Array","isArray","join","ContextMenu","toggleDropdown","Avatar","profileUrl","closeDropdown","MenuItems","paddingTop","paddingBottom","user","close","UserProfile","Label","LabelTypography","CAPTION_2","LabelColors","SECONDARY_3","ONBACKGROUND_2","friendName","nickname","CAPTION_3","ONBACKGROUND_3","createdAt","format","locale","Icon","IconColors","PRIMARY","TextButton","BODY_1","ONBACKGROUND_1","name","Loader","SPINNER","ERROR","showMenuTrigger","IconButton","MORE","isFineResend","MenuItem","CONTEXT_MENU_DROPDOWN__RESEND","isFineDelete","CONTEXT_MENU_DROPDOWN__DELETE"],"mappings":"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"}