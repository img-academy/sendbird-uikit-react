{"version":3,"file":"SuggestedMentionList.js","sources":["../../../../src/smart-components/Channel/components/SuggestedMentionList/SuggestedUserMentionItem.tsx","../../../../src/smart-components/Channel/components/SuggestedMentionList/index.tsx"],"sourcesContent":["import React, { useContext, useEffect, useMemo, useRef } from 'react';\n\nimport Avatar from '../../../../ui/Avatar';\nimport Label, { LabelTypography, LabelColors } from '../../../../ui/Label';\nimport { LocalizationContext } from '../../../../lib/LocalizationContext';\nimport SendBird from 'sendbird';\nimport { MentionItemUIEvent } from '../../../..';\n\ninterface SuggestedUserMentionItemProps {\n  member: SendBird.User | SendBird.Member;\n  isFocused?: boolean;\n  parentScrollRef?: React.RefObject<HTMLDivElement>;\n  onClick?: (props: MentionItemUIEvent) => void;\n  onMouseOver?: (props: MentionItemUIEvent) => void;\n  onMouseMove?: (props: MentionItemUIEvent) => void;\n  renderUserMentionItem?: (props: { user: SendBird.User | SendBird.Member }) => JSX.Element;\n}\n\nfunction SuggestedUserMentionItem(props: SuggestedUserMentionItemProps): JSX.Element {\n  const {\n    member,\n    isFocused = false,\n    parentScrollRef,\n    onClick,\n    onMouseOver,\n    onMouseMove,\n    renderUserMentionItem,\n  } = props;\n  const scrollRef = useRef(null);\n  const { stringSet = {} } = useContext(LocalizationContext);\n  useEffect(() => {\n    if (isFocused) {\n      if (parentScrollRef?.current?.scrollTop >= scrollRef?.current?.offsetTop) {\n        scrollRef?.current?.scrollIntoView({ block: \"start\", inline: \"nearest\" });\n      } else if (parentScrollRef?.current?.scrollTop + parentScrollRef?.current?.clientHeight <= scrollRef?.current?.offsetTop) {\n        scrollRef?.current?.scrollIntoView({ block: \"end\", inline: \"nearest\" });\n      }\n    }\n  }, [isFocused]);\n  const customMentionItem = useMemo(() => {\n    if (renderUserMentionItem) {\n      return (\n        <div\n          className=\"sendbird-mention-suggest-list__user-item\"\n          onClick={(event) => onClick?.({ event, member: (member as SendBird.Member), itemRef: scrollRef })}\n          onMouseOver={(event) => onMouseOver?.({ event, member: (member as SendBird.Member), itemRef: scrollRef })}\n          onMouseMove={(event) => onMouseMove?.({ event, member: (member as SendBird.Member), itemRef: scrollRef })}\n          key={member.nickname}\n          ref={scrollRef}\n        >\n          {renderUserMentionItem({ user: member })}\n        </div>\n      );\n    }\n  }, [renderUserMentionItem]);\n  if (customMentionItem) {\n    return customMentionItem;\n  }\n  return (\n    <div\n      className={`sendbird-mention-suggest-list__user-item ${isFocused ? 'focused' : ''}`}\n      onClick={(event) => onClick?.({ event, member: (member as SendBird.Member), itemRef: scrollRef })}\n      onMouseOver={(event) => onMouseOver?.({ event, member: (member as SendBird.Member), itemRef: scrollRef })}\n      onMouseMove={(event) => onMouseMove?.({ event, member: (member as SendBird.Member), itemRef: scrollRef })}\n      key={member.nickname}\n      ref={scrollRef}\n    >\n      <Avatar\n        className=\"sendbird-mention-suggest-list__user-item__avatar\"\n        src={member?.profileUrl}\n        alt=\"user-profile\"\n        width=\"24px\"\n        height=\"24px\"\n      />\n      <Label\n        className=\"sendbird-mention-suggest-list__user-item__nickname\"\n        type={LabelTypography.SUBTITLE_2}\n        color={member?.nickname ? LabelColors.ONBACKGROUND_1 : LabelColors.ONBACKGROUND_3}\n      >\n        {member?.nickname || stringSet?.MENTION_NAME__NO_NAME}\n      </Label>\n      <Label\n        className=\"sendbird-mention-suggest-list__user-item__user-id\"\n        type={LabelTypography.SUBTITLE_2}\n        color={LabelColors.ONBACKGROUND_2}\n      >\n        {member?.userId}\n      </Label>\n    </div>\n  );\n}\n\nexport default SuggestedUserMentionItem;\n","import React, { useState, useEffect, useContext, useRef } from 'react';\nimport SendBird from 'sendbird';\nimport './index.scss';\n\nimport Label, { LabelTypography, LabelColors } from '../../../../ui/Label';\nimport Icon, { IconTypes, IconColors } from '../../../../ui/Icon';\nimport SuggestedUserMentionItem from './SuggestedUserMentionItem';\nimport { useChannel } from '../../context/ChannelProvider';\nimport useSendbirdStateContext from '../../../../hooks/useSendbirdStateContext';\nimport { LocalizationContext } from '../../../../lib/LocalizationContext';\nimport { MAX_USER_MENTION_COUNT, MAX_USER_SUGGESTION_COUNT, USER_MENTION_TEMP_CHAR } from '../../context/const';\nimport { MessageInputKeys } from '../../../../ui/MessageInput/const';\n\nexport interface SuggestedMentionListProps {\n  targetNickname: string;\n  memberListQuery?: Record<string, string>;\n  onUserItemClick?: (member: SendBird.User) => void;\n  onFocusItemChange?: (member: SendBird.User) => void;\n  onFetchUsers?: (users: Array<SendBird.User>) => void;\n  renderUserMentionItem?: (props: { user: SendBird.User }) => JSX.Element;\n  ableAddMention: boolean;\n  maxMentionCount?: number;\n  maxSuggestionCount?: number;\n  inputEvent?: React.KeyboardEvent<HTMLDivElement>;\n}\n\nconst DEBOUNCING_TIME = 300;\n\nfunction SuggestedMentionList(props: SuggestedMentionListProps): JSX.Element {\n  const {\n    targetNickname = '',\n    // memberListQuery,\n    onUserItemClick,\n    onFocusItemChange,\n    onFetchUsers,\n    renderUserMentionItem,\n    inputEvent,\n    ableAddMention = true,\n    maxMentionCount = MAX_USER_MENTION_COUNT,\n    maxSuggestionCount = MAX_USER_SUGGESTION_COUNT,\n  } = props;\n  const { config, stores } = useSendbirdStateContext();\n  const { logger } = config;\n  const currentUserId = stores?.sdkStore?.sdk?.currentUser?.userId || '';\n  const { currentGroupChannel } = useChannel();\n  const scrollRef = useRef(null);\n  const { stringSet } = useContext(LocalizationContext);\n  const [timer, setTimer] = useState(null);\n  const [searchString, setSearchString] = useState('');\n  const [lastSearchString, setLastSearchString] = useState('');\n  const [currentUser, setCurrentUser] = useState<SendBird.User>(null);\n  const [currentMemberList, setCurrentMemberList] = useState<Array<SendBird.Member>>([]);\n\n  useEffect(() => {\n    clearTimeout(timer);\n    setTimer(\n      setTimeout(() => {\n        setSearchString(targetNickname);\n      }, DEBOUNCING_TIME)\n    );\n  }, [targetNickname]);\n\n  useEffect(() => {\n    if (inputEvent?.key === MessageInputKeys.Enter) {\n      if (currentMemberList.length > 0) {\n        onUserItemClick(currentUser);\n      }\n    }\n    if (inputEvent?.key === MessageInputKeys.ArrowUp) {\n      const currentUserIndex = currentMemberList.findIndex((member) => (\n        member?.userId === currentUser?.userId\n      ));\n      if (0 < currentUserIndex) {\n        setCurrentUser(currentMemberList[currentUserIndex - 1]);\n        onFocusItemChange(currentMemberList[currentUserIndex - 1]);\n      }\n    }\n    if (inputEvent?.key === MessageInputKeys.ArrowDown) {\n      const currentUserIndex = currentMemberList.findIndex((member) => (\n        member?.userId === currentUser?.userId\n      ));\n      if (currentUserIndex < currentMemberList.length - 1) {\n        setCurrentUser(currentMemberList[currentUserIndex + 1]);\n        onFocusItemChange(currentMemberList[currentUserIndex + 1]);\n      }\n    }\n  }, [inputEvent]);\n\n  /* Fetch member list */\n  useEffect(() => {\n    if (!currentGroupChannel || !currentGroupChannel.createMemberListQuery) {\n      logger.warning('SuggestedMentionList: Creating member list query failed');\n      return;\n    }\n    if (lastSearchString && searchString.indexOf(lastSearchString) === 0 && currentMemberList.length === 0) {\n      // Don't need to request query again\n      return;\n    }\n\n    const query = currentGroupChannel.createMemberListQuery();\n    query.limit = maxSuggestionCount;\n    query.nicknameStartsWithFilter = searchString.slice(USER_MENTION_TEMP_CHAR.length);\n    // Add member list query for customization\n    query.next((memberList, error) => {\n      if (error) {\n        logger.error('SuggestedMentionList: Fetching member list failed', error);\n      }\n      if (memberList.length < 1) {\n        logger.info('SuggestedMentionList: Fetched member list is empty');\n      } else {\n        logger.info('SuggestedMentionList: Fetching member list succeeded', { memberListQuery: query, memberList });\n        setCurrentUser(memberList[0]);\n      }\n      setLastSearchString(searchString);\n      onFetchUsers(memberList);\n      setCurrentMemberList(memberList.filter((member) => currentUserId !== member?.userId));\n    });\n  }, [currentGroupChannel?.url, searchString]);\n\n  if (!ableAddMention && currentMemberList.length === 0) {\n    return null;\n  }\n\n  return (\n    <div\n      className=\"sendbird-mention-suggest-list\"\n      key=\"sendbird-mention-suggest-list\"\n      ref={scrollRef}\n    >\n      {\n        ableAddMention && currentMemberList?.map((member) => (\n          <SuggestedUserMentionItem\n            key={member?.nickname}\n            member={member}\n            isFocused={member?.userId === currentUser?.userId}\n            parentScrollRef={scrollRef}\n            onClick={({ member }) => {\n              onUserItemClick(member);\n            }}\n            onMouseOver={({ member }) => {\n              setCurrentUser(member);\n            }}\n            renderUserMentionItem={renderUserMentionItem}\n          />\n        ))\n      }\n      {\n        !ableAddMention && (\n          <div className=\"sendbird-mention-suggest-list__notice-item\">\n            <Icon\n              className=\"sendbird-mention-suggest-list__notice-item__icon\"\n              type={IconTypes.INFO}\n              fillColor={IconColors.ON_BACKGROUND_2}\n              width=\"20px\"\n              height=\"20px\"\n            />\n            <Label\n              className=\"sendbird-mention-suggest-list__notice-item__text\"\n              type={LabelTypography.SUBTITLE_2}\n              color={LabelColors.ONBACKGROUND_2}\n            >\n              {stringSet.MENTION_COUNT__OVER_LIMIT.replace('%d', maxMentionCount)}\n            </Label>\n          </div>\n        )\n      }\n    </div>\n  );\n}\n\nexport default SuggestedMentionList;\n"],"names":["SuggestedUserMentionItem","props","member","_a","isFocused","parentScrollRef","onClick","onMouseOver","onMouseMove","renderUserMentionItem","scrollRef","useRef","_b","useContext","LocalizationContext","stringSet","useEffect","current","scrollTop","offsetTop","scrollIntoView","block","inline","clientHeight","customMentionItem","useMemo","React","event","itemRef","nickname","user","Avatar","profileUrl","Label","LabelTypography","SUBTITLE_2","LabelColors","ONBACKGROUND_1","ONBACKGROUND_3","MENTION_NAME__NO_NAME","ONBACKGROUND_2","userId","DEBOUNCING_TIME","SuggestedMentionList","_d","targetNickname","onUserItemClick","onFocusItemChange","onFetchUsers","inputEvent","_e","ableAddMention","_f","maxMentionCount","MAX_USER_MENTION_COUNT","_g","maxSuggestionCount","MAX_USER_SUGGESTION_COUNT","_h","useSendbirdStateContext","config","stores","logger","currentUserId","sdkStore","sdk","currentUser","currentGroupChannel","useChannel","_j","useState","timer","setTimer","_k","searchString","setSearchString","_l","lastSearchString","setLastSearchString","_m","setCurrentUser","_o","currentMemberList","setCurrentMemberList","clearTimeout","setTimeout","key","MessageInputKeys","Enter","length","ArrowUp","currentUserIndex","findIndex","ArrowDown","createMemberListQuery","warning","indexOf","query","limit","nicknameStartsWithFilter","slice","USER_MENTION_TEMP_CHAR","next","memberList","error","info","memberListQuery","filter","url","map","Icon","IconTypes","INFO","IconColors","ON_BACKGROUND_2","MENTION_COUNT__OVER_LIMIT","replace"],"mappings":"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"}