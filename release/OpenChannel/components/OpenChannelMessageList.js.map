{"version":3,"file":"OpenChannelMessageList.js","sources":["../../../src/smart-components/OpenChannel/components/OpenChannelMessageList/index.tsx"],"sourcesContent":["import './openchannel-message-list.scss';\n\nimport React, { ReactElement, useRef, useState, useMemo } from 'react';\nimport isSameDay from 'date-fns/isSameDay';\n\n// import MessageHoc from './MessageHOC';\nimport Icon, { IconTypes, IconColors } from '../../../../ui/Icon';\n\nimport PlaceHolder, { PlaceHolderTypes } from '../../../../ui/PlaceHolder';\nimport { compareMessagesForGrouping } from '../../context/utils';\nimport { useOpenChannel } from '../../context/OpenChannelProvider';\nimport OpenChannelMessage from '../OpenChannelMessage';\nimport { RenderMessageProps } from '../../../../types';\n\nexport type OpenchannelMessageListProps = {\n  renderMessage?: (props: RenderMessageProps) => React.ReactNode;\n  renderPlaceHolderEmptyList?: () => React.ReactNode;\n}\n\nfunction OpenchannelMessageList(\n  props: OpenchannelMessageListProps,\n  ref: React.RefObject<HTMLDivElement>,\n): ReactElement {\n  const {\n    useMessageGrouping = true,\n    allMessages,\n    hasMore,\n    onScroll,\n  } = useOpenChannel();\n  const scrollRef = ref || useRef(null);\n  const [showScrollDownButton, setShowScrollDownButton] = useState(false);\n\n  const handleOnScroll = (e) => {\n    const element = e.target;\n    const {\n      scrollTop,\n      scrollHeight,\n      clientHeight,\n    } = element;\n    if (\n      (scrollHeight > scrollTop + clientHeight)\n      && (window.navigator.userAgent.indexOf('MSIE ') < 0) // don't show button in IE\n    ) {\n      setShowScrollDownButton(true);\n    } else {\n      setShowScrollDownButton(false);\n    }\n\n    if (!hasMore) {\n      return;\n    }\n    if (scrollTop === 0) {\n      const nodes = scrollRef.current.querySelectorAll('.sendbird-msg--scroll-ref');\n      const first = nodes && nodes[0];\n      onScroll(() => {\n        try {\n          first.scrollIntoView();\n        } catch (error) { }\n      });\n    }\n  };\n\n  const scrollToBottom = () => {\n    if (scrollRef && scrollRef.current) {\n      scrollRef.current.scrollTo(0, scrollRef.current.scrollHeight);\n      setShowScrollDownButton(false);\n    }\n  };\n\n  const hasMessage = useMemo(() => {\n    return allMessages.length > 0;\n  }, [allMessages.length]);\n\n  return (\n    <div\n      className=\"sendbird-openchannel-conversation-scroll\"\n      onScroll={handleOnScroll}\n      ref={scrollRef}\n    >\n      <div className=\"sendbird-openchannel-conversation-scroll__container\">\n        <div className=\"sendbird-openchannel-conversation-scroll__container__padding\" />\n        <div className={`sendbird-openchannel-conversation-scroll__container__item-container${hasMessage ? '' : '--no-messages'}`}>\n          {\n            hasMessage\n              ? (\n                allMessages.map((message, index) => {\n                  const previousMessage = allMessages[index - 1];\n                  const nextMessage = allMessages[index - 1];\n\n                  const previousMessageCreatedAt = previousMessage && previousMessage.createdAt;\n                  const currentCreatedAt = message.createdAt;\n                  // https://stackoverflow.com/a/41855608\n                  const hasSeparator = !(previousMessageCreatedAt && (\n                    isSameDay(currentCreatedAt, previousMessageCreatedAt)\n                  ));\n\n                  const [chainTop, chainBottom] = useMessageGrouping\n                    ? compareMessagesForGrouping(previousMessage, message, nextMessage)\n                    : [false, false];\n                  return (\n                    <OpenChannelMessage\n                      key={message?.messageId || message?.reqId}\n                      message={message}\n                      chainTop={chainTop}\n                      chainBottom={chainBottom}\n                      hasSeparator={hasSeparator}\n                      renderMessage={props?.renderMessage}\n                    />\n                  )\n                })\n              )\n              : props?.renderPlaceHolderEmptyList?.() || (\n                <PlaceHolder\n                  className=\"sendbird-openchannel-conversation-scroll__container__place-holder\"\n                  type={PlaceHolderTypes.NO_MESSAGES}\n                />\n              )\n          }\n        </div>\n        {\n          showScrollDownButton && (\n            <div\n              className=\"sendbird-openchannel-conversation-scroll__container__scroll-bottom-button\"\n              onClick={scrollToBottom}\n              onKeyDown={scrollToBottom}\n              tabIndex={0}\n              role=\"button\"\n            >\n              <Icon\n                width=\"24px\"\n                height=\"24px\"\n                type={IconTypes.CHEVRON_DOWN}\n                fillColor={IconColors.CONTENT}\n              />\n            </div>\n          )\n        }\n      </div>\n    </div>\n  );\n}\n\nexport default React.forwardRef(OpenchannelMessageList);\n"],"names":["OpenchannelMessageList","props","ref","_b","useOpenChannel","_c","useMessageGrouping","allMessages","hasMore","onScroll","scrollRef","useRef","_d","useState","showScrollDownButton","setShowScrollDownButton","handleOnScroll","e","element","target","scrollTop","scrollHeight","clientHeight","window","navigator","userAgent","indexOf","nodes","current","querySelectorAll","first_1","scrollIntoView","error","scrollToBottom","scrollTo","hasMessage","useMemo","length","React","map","message","index","previousMessage","nextMessage","previousMessageCreatedAt","createdAt","currentCreatedAt","hasSeparator","isSameDay","_a","compareMessagesForGrouping","chainTop","chainBottom","OpenChannelMessage","messageId","reqId","renderMessage","renderPlaceHolderEmptyList","PlaceHolderTypes","NO_MESSAGES","IconTypes","CHEVRON_DOWN","IconColors","CONTENT","forwardRef"],"mappings":"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"}