{"version":3,"file":"MessageItemMenu.js","sources":["../../src/ui/MessageItemMenu/index.tsx"],"sourcesContent":["import React, { ReactElement, useContext, useRef } from 'react';\nimport { FileMessage, GroupChannel, OpenChannel, UserMessage } from 'sendbird';\nimport './index.scss';\n\nimport ContextMenu, { MenuItems, MenuItem } from '../ContextMenu';\nimport Icon, { IconTypes, IconColors } from '../Icon';\nimport IconButton from '../IconButton';\nimport {\n  getClassName,\n  copyToClipboard,\n  isUserMessage,\n  isSentMessage,\n  isFailedMessage,\n  isPendingMessage,\n} from '../../utils/index';\nimport { LocalizationContext } from '../../lib/LocalizationContext';\nimport { ReplyType } from '../../index';\n\ninterface Props {\n  className?: string | Array<string>;\n  message: UserMessage | FileMessage;\n  channel: GroupChannel | OpenChannel;\n  isByMe?: boolean;\n  disabled?: boolean;\n  replyType?: ReplyType;\n  showEdit?: (bool: boolean) => void;\n  showRemove?: (bool: boolean) => void;\n  resendMessage?: (message: UserMessage | FileMessage) => void;\n  setQuoteMessage?: (message: UserMessage | FileMessage) => void;\n  setSupposedHover?: (bool: boolean) => void;\n}\n\nexport default function MessageItemMenu({\n  className,\n  message,\n  channel,\n  isByMe = false,\n  disabled = false,\n  replyType,\n  showEdit,\n  showRemove,\n  resendMessage,\n  setQuoteMessage,\n  setSupposedHover,\n}: Props): ReactElement {\n  const { stringSet } = useContext(LocalizationContext);\n  const triggerRef = useRef(null);\n  const containerRef = useRef(null);\n\n  const showMenuItemCopy: boolean = isUserMessage(message as UserMessage);\n  const showMenuItemEdit: boolean = (isUserMessage(message as UserMessage) && isSentMessage(message) && isByMe);\n  const showMenuItemResend: boolean = (isFailedMessage(message) && message?.isResendable?.() && isByMe);\n  const showMenuItemDelete: boolean = !isPendingMessage(message) && isByMe;\n  /**\n   * TODO: Manage timing issue\n   * User delete pending message -> Sending message success\n   */\n  const showMenuItemReply: boolean = (replyType === 'QUOTE_REPLY')\n    && !isFailedMessage(message)\n    && !isPendingMessage(message)\n    && (channel?.isGroupChannel() && !(channel as GroupChannel)?.isBroadcast);\n\n  if (!(showMenuItemCopy || showMenuItemReply || showMenuItemEdit || showMenuItemResend || showMenuItemDelete)) {\n    return null;\n  }\n  return (\n    <div\n      className={getClassName([className, 'sendbird-message-item-menu'])}\n      ref={containerRef}\n    >\n      <ContextMenu\n        menuTrigger={(toggleDropdown: () => void): ReactElement => (\n          <IconButton\n            className=\"sendbird-message-item-menu__trigger\"\n            ref={triggerRef}\n            width=\"32px\"\n            height=\"32px\"\n            onClick={(): void => {\n              toggleDropdown();\n              setSupposedHover(true);\n            }}\n            onBlur={(): void => {\n              setSupposedHover(false);\n            }}\n          >\n            <Icon\n              className=\"sendbird-message-item-menu__trigger__icon\"\n              type={IconTypes.MORE}\n              fillColor={IconColors.CONTENT_INVERSE}\n              width=\"24px\"\n              height=\"24px\"\n            />\n          </IconButton>\n        )}\n        menuItems={(close: () => void): ReactElement => {\n          const closeDropdown = (): void => {\n            close();\n            setSupposedHover(false);\n          };\n          return (\n            <MenuItems\n              className=\"sendbird-message-item-menu__list\"\n              parentRef={triggerRef}\n              parentContainRef={containerRef}\n              closeDropdown={closeDropdown}\n              openLeft={isByMe}\n            >\n              {showMenuItemCopy && (\n                <MenuItem\n                  className=\"sendbird-message-item-menu__list__menu-item menu-item-copy\"\n                  onClick={() => {\n                    copyToClipboard((message as UserMessage)?.message);\n                    closeDropdown();\n                  }}\n                >\n                  {stringSet.MESSAGE_MENU__COPY}\n                </MenuItem>\n              )}\n              {showMenuItemReply && (\n                <MenuItem\n                  className=\"sendbird-message-item-menu__list__menu-item menu-item-reply\"\n                  onClick={() => {\n                    setQuoteMessage(message);\n                    closeDropdown();\n                  }}\n                  disable={message?.parentMessageId > 0}\n                >\n                  {stringSet.MESSAGE_MENU__REPLY}\n                </MenuItem>\n              )}\n              {showMenuItemEdit && (\n                <MenuItem\n                  className=\"sendbird-message-item-menu__list__menu-item menu-item-edit\"\n                  onClick={() => {\n                    if (!disabled) {\n                      showEdit(true);\n                      closeDropdown();\n                    }\n                  }}\n                >\n                  {stringSet.MESSAGE_MENU__EDIT}\n                </MenuItem>\n              )}\n              {showMenuItemResend && (\n                <MenuItem\n                  className=\"sendbird-message-item-menu__list__menu-item menu-item-resend\"\n                  onClick={() => {\n                    if (!disabled) {\n                      resendMessage(message);\n                      closeDropdown();\n                    }\n                  }}\n                >\n                  {stringSet.MESSAGE_MENU__RESEND}\n                </MenuItem>\n              )}\n              {showMenuItemDelete && (\n                <MenuItem\n                  className=\"sendbird-message-item-menu__list__menu-item menu-item-delete\"\n                  onClick={() => {\n                    if (!disabled) {\n                      showRemove(true);\n                      closeDropdown();\n                    }\n                  }}\n                  disable={message?.threadInfo?.replyCount > 0}\n                >\n                  {stringSet.MESSAGE_MENU__DELETE}\n                </MenuItem>\n              )}\n            </MenuItems>\n          );\n        }}\n      />\n    </div>\n  );\n}\n"],"names":["MessageItemMenu","_a","className","message","channel","_d","isByMe","_e","disabled","replyType","showEdit","showRemove","resendMessage","setQuoteMessage","setSupposedHover","stringSet","useContext","LocalizationContext","triggerRef","useRef","containerRef","showMenuItemCopy","isUserMessage","showMenuItemEdit","isSentMessage","showMenuItemResend","isFailedMessage","isResendable","showMenuItemDelete","isPendingMessage","showMenuItemReply","isGroupChannel","isBroadcast","React","getClassName","toggleDropdown","IconTypes","MORE","IconColors","CONTENT_INVERSE","close","closeDropdown","copyToClipboard","MESSAGE_MENU__COPY","parentMessageId","MESSAGE_MENU__REPLY","MESSAGE_MENU__EDIT","MESSAGE_MENU__RESEND","threadInfo","replyCount","MESSAGE_MENU__DELETE"],"mappings":"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"}